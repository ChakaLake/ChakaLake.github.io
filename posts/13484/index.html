<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Security Onion|安全洋葱架构概述 | 他年少如歌</title><meta name="description" content="Security Onion是一款专为入侵检测和NSM（网络安全监控）设计的Linux发行版。其安装过程很简单，再短时间内就可以部署一套完整的NSM收集、检测和分析的套件。Security Onion可能是主动的，用于识别漏洞或过期的SSL证书。或者也可能是被动的，如事件响应和网络取证。其镜像可以作为传感器分布在网络中，以监控多个VLAN和子网。 安全洋葱核心功能Security Onion里面的"><meta name="keywords" content="网络安全"><meta name="author" content="他年少如歌"><meta name="copyright" content="他年少如歌"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://chakalake.gitee.io/posts/13484/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="Security Onion|安全洋葱架构概述"><meta property="og:url" content="https://chakalake.gitee.io/posts/13484/"><meta property="og:site_name" content="他年少如歌"><meta property="og:description" content="Security Onion是一款专为入侵检测和NSM（网络安全监控）设计的Linux发行版。其安装过程很简单，再短时间内就可以部署一套完整的NSM收集、检测和分析的套件。Security Onion可能是主动的，用于识别漏洞或过期的SSL证书。或者也可能是被动的，如事件响应和网络取证。其镜像可以作为传感器分布在网络中，以监控多个VLAN和子网。 安全洋葱核心功能Security Onion里面的"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/037.webp"><meta property="article:published_time" content="2020-03-02T10:06:46.000Z"><meta property="article:modified_time" content="2021-03-20T11:42:05.217Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="Splunk|大数据分析经验分享" href="https://chakalake.gitee.io/posts/23350/"><link rel="next" title="漏洞复现|Tomcat Ajp(CVE-2020-1938)" href="https://chakalake.gitee.io/posts/47924/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-20 19:42:05'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Chocolate1999/cdn/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">3</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#安全洋葱核心功能"><span class="toc-number">1.</span> <span class="toc-text">安全洋葱核心功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安全洋葱框架图"><span class="toc-number">2.</span> <span class="toc-text">安全洋葱框架图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安全洋葱框架介绍"><span class="toc-number">3.</span> <span class="toc-text">安全洋葱框架介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NIDS"><span class="toc-number">3.1.</span> <span class="toc-text">NIDS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#流量采集组件"><span class="toc-number">3.1.1.</span> <span class="toc-text">流量采集组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流量分析组件"><span class="toc-number">3.1.2.</span> <span class="toc-text">流量分析组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日志解析组件"><span class="toc-number">3.1.3.</span> <span class="toc-text">日志解析组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件检索组件"><span class="toc-number">3.1.4.</span> <span class="toc-text">事件检索组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#分析工具"><span class="toc-number">3.1.5.</span> <span class="toc-text">分析工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他分析工具"><span class="toc-number">3.1.6.</span> <span class="toc-text">其他分析工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HIDS"><span class="toc-number">3.2.</span> <span class="toc-text">HIDS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#部署方案"><span class="toc-number">4.</span> <span class="toc-text">部署方案</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安全洋葱的使用"><span class="toc-number">5.</span> <span class="toc-text">安全洋葱的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对硬件要求"><span class="toc-number">5.1.</span> <span class="toc-text">对硬件要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署要点"><span class="toc-number">5.2.</span> <span class="toc-text">部署要点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#规则配置"><span class="toc-number">5.3.</span> <span class="toc-text">规则配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发现攻击后，要做什么"><span class="toc-number">5.4.</span> <span class="toc-text">发现攻击后，要做什么</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安全洋葱文件路径"><span class="toc-number">6.</span> <span class="toc-text">安全洋葱文件路径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/037.webp)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">他年少如歌</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Security Onion|安全洋葱架构概述</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-03-02 18:06:46"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-03-02</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-03-20 19:42:05"><i class="fas fa-history fa-fw"></i> 更新于 2021-03-20</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E5%AE%89%E5%85%A8%E6%B4%8B%E8%91%B1/">安全洋葱</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>Security Onion是一款专为入侵检测和NSM（网络安全监控）设计的Linux发行版。其安装过程很简单，再短时间内就可以部署一套完整的NSM收集、检测和分析的套件。Security Onion可能是主动的，用于识别漏洞或过期的SSL证书。或者也可能是被动的，如事件响应和网络取证。其镜像可以作为传感器分布在网络中，以监控多个VLAN和子网。</p>
<h1 id="安全洋葱核心功能"><a href="#安全洋葱核心功能" class="headerlink" title="安全洋葱核心功能"></a>安全洋葱核心功能</h1><p>Security Onion里面的组件包括：snort（入侵检测引擎）、suricata（入侵检测引擎）、bro（入侵检测分析系统）、sguil（入侵检测分析系统）、squert（前端显示）、snorby（前端显示）、wireshark（抓包）、xplico（流量审计）。<br>Security Onion将三个核心功能无缝融合在一起<br>1、完整数据包捕获<br>2、基于网络和基于主机的入侵检测系统（分别为NIDS和HIDS）<br>3、强大的分析工具<br><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/022002.png" alt=""></p>
<h1 id="安全洋葱框架图"><a href="#安全洋葱框架图" class="headerlink" title="安全洋葱框架图"></a>安全洋葱框架图</h1><p><img src= "/img/loading.gif" data-src="https://raw.githubusercontent.com/ChakaLake/ywd/master/img/022001.png" alt=""></p>
<h1 id="安全洋葱框架介绍"><a href="#安全洋葱框架介绍" class="headerlink" title="安全洋葱框架介绍"></a>安全洋葱框架介绍</h1><p>基于网络和基于主机的入侵检测系统分贝分析网络流量和主机系统，并为检测的事件和活动提供日志和警报数据。</p>
<h2 id="NIDS"><a href="#NIDS" class="headerlink" title="NIDS"></a>NIDS</h2><p>安全洋葱主要由流量采集，流量分析，日志解析，事件检索，分析工具5个组件组成。</p>
<h3 id="流量采集组件"><a href="#流量采集组件" class="headerlink" title="流量采集组件"></a>流量采集组件</h3><p>采集网口中的完整流量包<br>①netsniff-ng<br>捕获完整流量包，netsniff-ng能捕获到所有传感器看到和存储的流量（安全Onion有一个内置机制可在磁盘满容量之前清楚旧数据）。完整的数据包捕获就像摄像机，它不仅能告诉我们谁来了，谁走了，还能确切知道他们去哪里了，以及他们携带的内容（exp的payload，钓鱼邮件和文件泄露等）。</p>
<h3 id="流量分析组件"><a href="#流量分析组件" class="headerlink" title="流量分析组件"></a>流量分析组件</h3><p>和netsniff-ng组件独立，实时监控和分析当前网络流量<br>①Bro<br>实时基于分析驱动的分析检测流量，输出分析日志，不保存原始流量<br>②Snort/Suricata<br>实时基于规则分析检测流量，输出分析日志，默认unified2格式，分析结果可以通过Sguil，Elasticsearch查看，不保存原始流量</p>
<h3 id="日志解析组件"><a href="#日志解析组件" class="headerlink" title="日志解析组件"></a>日志解析组件</h3><p>解析和正则化Bro，Snort/Suricata生成的日志文件，生成事件，供Elasticsearch检索<br>①Logstash<br>是一个开源的服务器端数据处理管道，它同时从多个源中提取数据，对其进行转换，然后将其发送到存储点，由Bro生成的log和Snort/Suricata生成的分析结果，经过解析和正则化后生成的日志组成，因为使用的是进程通信管道，所以有队列，分为磁盘队列和内存队列，队列中的单位为事件</p>
<h3 id="事件检索组件"><a href="#事件检索组件" class="headerlink" title="事件检索组件"></a>事件检索组件</h3><p>对Logstash生成的事件进行管理和检索<br>①Elasticsearch<br>社区和索引日志，输入数据为Logstash，是一个分布式RESful（一种软件设计风格）搜索和分析引擎，其中Elasticsearch由4个小组件组成：<br>a、Curator<br>用于定期管理Elasticsearch索引和快照<br>b、DomainStats<br>通过上下文获取域名的附加信息，例如创建时间，年龄，信誉（确定域名是否是Alexa/Cisco Umbrella前100万个站点的成员），domain_stats,py，它被开发用于与SIEM结合使用并且在生产环境中。具体来说，它已与弹性堆栈结合使用，例如Logstash查询，取得了巨大成功。在Production Mode使用Best Practices模式下是不开启的，要自己单独开启，并且需要互联网，需要连接到外网的whois服务器<br>c、ElastAlert<br>是一个简单的框架，基于规则，用户告警Elasticsearch中数据的异常，还有多种警报机制，例如Slack，Email<br>d、FreqServer<br>检测DGA和查找随机文件名，脚本名称，进程名称，服务名称，工作站名称，TLS证书主题和颁发者主题等，基于freq.py和freq_server.py，在Production Mode使用Best Practies 模式下是不开启的，要自己单独开启。</p>
<h3 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h3><p>安全洋葱提供多种可视化事件追溯，分析工具。<br>①Sguil<br>用于查看Snort或suricata警报，和Bro HTTP事件。更重要的是，Sguil允许您直接从警报“转移”到数据包捕获（通过Wireshark或NetworkMiner）或触发警报的完整会话记录。本质是mysql数据库。<br>②Squert<br>服务于Sguil，它允许查询Sguil数据库并为数据提供多种可视化选项，例如事件序列表示，加权和逻辑分组结果集和IP地理未知映射等。还尝试通过使用元数据，时间序列表示以及加权和逻辑分组的结果集来为事件提供额外信息。<br>③Kibana<br>可视化，可以快速分析和转换so生成的不同数据类型，最主要的目的是配置Elasticsearch工作，进行高级数据分析。</p>
<h3 id="其他分析工具"><a href="#其他分析工具" class="headerlink" title="其他分析工具"></a>其他分析工具</h3><p>①CapME<br>主要服务于sguil，也是一个web界面，主要功能<br>a、查看使用tcpflow呈现的pcap脚本<br>b、查看用Bro渲染的pcap脚本（特别有助于处理gzip编码）<br>c、下载一个pcap</p>
<h2 id="HIDS"><a href="#HIDS" class="headerlink" title="HIDS"></a>HIDS</h2><p>对于基于主机的入侵检测，Security Onion为Windows，Linux和Mac Os提供了免费的开源HIDS方案-OSSEC。OSSEC可执行日志文件、文件完整性检查、策略监控、rookit检测，并实时报警和主动响应。我们可以将基于主机的事件和基于网络的事件关联起来，来识别是否有成功攻击的事件。</p>
<h1 id="部署方案"><a href="#部署方案" class="headerlink" title="部署方案"></a>部署方案</h1><p>Security Onion建立再分布式客户端-服务器模型上。Security Onion的“sensor（传感器）”是客户端，“server”就是服务器。服务器和传感器组件可以再单个物理机器或虚拟机上运行，也可以将多个传感器分布在整个基础架构中，并配置为向指定服务器报告。分析人员从客户端工作站（通常是虚拟机安装）连接到服务器以执行查询和检索数据。<br>以下是Security Onion的三种部署方案：<br>1、独立：独立安装由运行服务器和传感器组件以及相关进程的单个物理或虚拟机组成。独立安装可以有多个网络接口监视不同的网段。独立安装是监控可从单个未知访问的网络的最简单且最方便的方法。<br>2、服务器-传感器：服务器-传感器安装保罗运行服务器组件的单个机器，其中一个或多个单独的机器运行传感器组件并向服务器报告。传感器运行所有嗅探过程并存储Sguil和ELSA的相关数据包捕获，IDS警报和数据库。分析人员从单独的客户端计算机连接到服务器，并且发动到服务器的所有查询都被分发到适当的传感器，所请求的信息被定向回客户端。此模型通过将大量收集的数据保留在传感器上，直到分析师的客户端请求位置，从而减少了网络流量。服务器和传感器之间的所有力量都已加密，客户端和服务器之间的所有流量都已加密。<br>3、混合：混合安装由独立安装组成，该安装还具有一个或多个单独的传感器，这些传感器向独立机器的服务器组件报告。</p>
<h1 id="安全洋葱的使用"><a href="#安全洋葱的使用" class="headerlink" title="安全洋葱的使用"></a>安全洋葱的使用</h1><h2 id="对硬件要求"><a href="#对硬件要求" class="headerlink" title="对硬件要求"></a>对硬件要求</h2><p>snort：200~300Mbps时开始丢包，500Mbps时无法工作（不推荐使用该引擎）<br>suricata：能承受的流量比snort高，结合pfring可以承受很高的流量</p>
<h2 id="部署要点"><a href="#部署要点" class="headerlink" title="部署要点"></a>部署要点</h2><p>一般情况下，so的功能非常多。同时开启多个功能会非常小号性能。部署的未知时首先要明确你要保护什么，想要获得什么情报。推荐的部署位置是出口线路、机密服务器到普通网络之间的线路。一般部署步骤：上线运行一段时间，把排名前几位的确认无用的SID写进disablesid.conf里面剔除掉（噪声过滤），然后再根据业务需求写自定义规则。</p>
<h2 id="规则配置"><a href="#规则配置" class="headerlink" title="规则配置"></a>规则配置</h2><p>suricata可以使用ET和GPL等检测规则。但是后期需要进行持续优化以及自定义。如果规则可以简单分为官方规则和自定义规则。官方规则是由一些专业的安全人员写出来的。一般如果不是对安全原理研究的特别深的情况下，不用去动他。自定义规则可以在官方规则基础上根据自己的需要进行修改。<br>自定义规则可以这样写（举例）：<br>在非工作时间又非自动系统账号登录LVS就产生告警。<br>针对某服务器（没有修复）检测到heart beat特征就告警。<br>IDC的服务器不是通过堡垒机登录的就告警。</p>
<h2 id="发现攻击后，要做什么"><a href="#发现攻击后，要做什么" class="headerlink" title="发现攻击后，要做什么"></a>发现攻击后，要做什么</h2><p>可以使用防火墙阻挡已知的攻击，用交换机/路由器的ACL阻挡攻击者的IP、推进漏洞修复工作、该井安全策略等。如果公司有座威胁情报，可以将已知攻击加到情报库，坐更深入的研究。</p>
<h1 id="安全洋葱文件路径"><a href="#安全洋葱文件路径" class="headerlink" title="安全洋葱文件路径"></a>安全洋葱文件路径</h1><p>1、/usr/sbin/so-*    该目录下存放的所有组件的启动，关闭服务等<br>2、/ect/nsm    so的配置和数据<br>①rules该文件包干了Snort/suricata等规则<br>3、/nsm    存放so收集输出的所有数据，子目录如下：<br>①bro    主要存放bro组件产生的日志<br>②elasticsearch<br>③improt<br>④logstash<br>⑤sensor_data    传感器收集到的日志<br>a、dailylogs    主要存放netsniff-ng抓到的完整流量包<br>b、snort.unified2.时间戳    Snort/Suricata输出的ids检测结果，unified2格式，查看或者获取可以通过sguil或者mysql中的数据表。<br>⑥server_data<br>5、/etc/logstash    logstash的配置目录<br>6、/etc/elastalert    ElastAlert的配置目录<br>7、/ect/Kibana    Kinaba的配置文件<br>8、/opt    安全洋葱so组件的源代码</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>因此，我们拥有完整的数据包捕获，Snort或Suricata规则驱动的入侵检测，Bro事件驱动的入侵检测和OSSEC基于主机的入侵检测，一旦运行Security Onion安装程序，所有这些都会立即启动。这些具有各种依赖性和复杂性的不同系统可以无缝地运行在一起，否则需要数小时，数天或数周来自行组装和集成。曾经看似不可能完成的任务现在与Windows系统一样容易安装。<br>虽然Security Onion的安全配置比较简单，网上也有大量的资料。但是由于Security Onion集成了很多IDS组件，部分我们也用不到，都开启的话会非常消耗性能。建议企业还是应该根据自身的需求，选择更适合自身的某个方案，做深入的研究。例如Nids可以选择Snort、Suricata、Bro其中的一种，Hids可以选择Ossec。集成固然好，但不太好用。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">他年少如歌</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chakalake.gitee.io/posts/13484/">https://chakalake.gitee.io/posts/13484/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chakalake.gitee.io" target="_blank">他年少如歌</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/004.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/23350/"><img class="prev-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/036.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Splunk|大数据分析经验分享</div></div></a></div><div class="next-post pull-right"><a href="/posts/47924/"><img class="next-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/025.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">漏洞复现|Tomcat Ajp(CVE-2020-1938)</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> 他年少如歌</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 4.2.0"></head></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":120,"height":260},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>